commit 2e1fe85af1aae8dec4d797f7140ea54bfaea59dc
Author: Eric Anholt <eric@anholt.net>
Date:   Tue Oct 31 11:33:10 2017 -0700

    drm/vc4: Skip ULPS latching when we're in that ULPS state already.
    
    It seems that trying to go from unlatched to unlatched will time out
    waiting for STOP, and we can just skip that.
    
    Signed-off-by: Eric Anholt <eric@anholt.net>

diff --git a/drivers/gpu/drm/vc4/vc4_dsi.c b/drivers/gpu/drm/vc4/vc4_dsi.c
index 94085f8bcd68..8aa897835118 100644
--- a/drivers/gpu/drm/vc4/vc4_dsi.c
+++ b/drivers/gpu/drm/vc4/vc4_dsi.c
@@ -753,6 +753,11 @@ static void vc4_dsi_ulps(struct vc4_dsi *dsi, bool ulps)
 			 (dsi->lanes > 2 ? DSI1_STAT_PHY_D2_STOP : 0) |
 			 (dsi->lanes > 3 ? DSI1_STAT_PHY_D3_STOP : 0));
 	int ret;
+	bool ulps_currently_enabled = (DSI_PORT_READ(PHY_AFEC0) &
+				       DSI_PORT_BIT(PHY_AFEC0_LATCH_ULPS));
+
+	if (ulps == ulps_currently_enabled)
+		return;
 
 	DSI_PORT_WRITE(STAT, stat_ulps);
 	DSI_PORT_WRITE(PHYC, DSI_PORT_READ(PHYC) | phyc_ulps);
diff -uN a/1.txt b/1.txt
--- a/dummy/rpi_1186_2e1fe85af1aae8dec4d797f7140ea54bfaea59dc.txt	1970-01-01 00:00:00.000000000 +0000
+++ b/dummy/rpi_1186_2e1fe85af1aae8dec4d797f7140ea54bfaea59dc.txt	2013-12-23 04:07:40.000000000 +0000
@@ -0,0 +1 @@
+dummy file to ensure patch has content.
