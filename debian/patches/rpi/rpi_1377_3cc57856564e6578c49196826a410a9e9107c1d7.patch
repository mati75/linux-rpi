commit 3cc57856564e6578c49196826a410a9e9107c1d7
Author: Julian Anastasov <ja@ssi.bg>
Date:   Sun Feb 26 17:14:35 2017 +0200

    ipv4: mask tos for input route
    
    [ Upstream commit 6e28099d38c0e50d62c1afc054e37e573adf3d21 ]
    
    Restore the lost masking of TOS in input route code to
    allow ip rules to match it properly.
    
    Problem [1] noticed by Shmulik Ladkani <shmulik.ladkani@gmail.com>
    
    [1] http://marc.info/?t=137331755300040&r=1&w=2
    
    Fixes: 89aef8921bfb ("ipv4: Delete routing cache.")
    Signed-off-by: Julian Anastasov <ja@ssi.bg>
    Signed-off-by: David S. Miller <davem@davemloft.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

Index: linux-4.9.47/net/ipv4/route.c
===================================================================
--- linux-4.9.47.orig/net/ipv4/route.c
+++ linux-4.9.47/net/ipv4/route.c
@@ -2182,6 +2182,7 @@ struct rtable *__ip_route_output_key_has
 	fl4->flowi4_scope = ((tos & RTO_ONLINK) ?
 			 RT_SCOPE_LINK : RT_SCOPE_UNIVERSE);
 
+	tos &= IPTOS_RT_MASK;
 	rcu_read_lock();
 	if (fl4->saddr) {
 		rth = ERR_PTR(-EINVAL);
Index: linux-4.9.47/dummy/rpi_1377_3cc57856564e6578c49196826a410a9e9107c1d7.txt
===================================================================
--- /dev/null
+++ linux-4.9.47/dummy/rpi_1377_3cc57856564e6578c49196826a410a9e9107c1d7.txt
@@ -0,0 +1 @@
+dummy file to ensure patch has content.
